(window.webpackJsonp=window.webpackJsonp||[]).push([[85],{535:function(n,s,e){"use strict";e.r(s);var t=e(1),a=Object(t.a)({},(function(){var n=this,s=n.$createElement,e=n._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[e("h2",{attrs:{id:"全表扫描了"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#全表扫描了"}},[n._v("#")]),n._v(" 全表扫描了")]),n._v(" "),e("p",[n._v("如果你的分片是有序的并且可以通过某些字段排序来进行过滤，sharding-core提供了顺序查询功能,"),e("a",{attrs:{href:"https://www.cnblogs.com/xuejiaming/p/15848454.html",target:"_blank",rel:"noopener noreferrer"}},[n._v("解决方案"),e("OutboundLink")],1)]),n._v(" "),e("h2",{attrs:{id:"全局提示或阶段防止全表扫描"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#全局提示或阶段防止全表扫描"}},[n._v("#")]),n._v(" 全局提示或阶段防止全表扫描")]),n._v(" "),e("p",[n._v("通过路由后置过滤器")]),n._v(" "),e("div",{staticClass:"language-chsarp line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v('public class SysUserLogByMonthRoute:AbstractSimpleShardingMonthKeyDateTimeVirtualTableRoute<SysUserLogByMonth>\n    {\n        private readonly ILogger<SysUserLogByMonthRoute> _logger;\n\n        public SysUserLogByMonthRoute(ILogger<SysUserLogByMonthRoute> logger)\n        {\n            _logger = logger;\n        }\n        public override DateTime GetBeginTime()\n        {\n            return new DateTime(2021, 1, 01);\n        }\n\n        public override bool AutoCreateTableByTime()\n        {\n            return true;\n        }\n\n        public override void Configure(EntityMetadataTableBuilder<SysUserLogByMonth> builder)\n        {\n            builder.ShardingProperty(o => o.Time);\n        }\n\n        protected override List<TableRouteUnit> AfterShardingRouteUnitFilter(DataSourceRouteResult dataSourceRouteResult, List<TableRouteUnit> shardingRouteUnits)\n        {\n            if (shardingRouteUnits.Count > 10)\n            {\n                _logger.LogInformation("截断前:"+string.Join(",",shardingRouteUnits.Select(o=>o.Tail)));\n                //这边你要自己做顺序处理阶段\n                var result= shardingRouteUnits.OrderByDescending(o=>o.Tail).Take(10).ToList();\n                _logger.LogInformation("截断后:"+string.Join(",",result.Select(o=>o.Tail)));\n                return result;\n            }\n            return base.AfterShardingRouteUnitFilter(dataSourceRouteResult, shardingRouteUnits);\n        }\n    }\n')])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br"),e("span",{staticClass:"line-number"},[n._v("8")]),e("br"),e("span",{staticClass:"line-number"},[n._v("9")]),e("br"),e("span",{staticClass:"line-number"},[n._v("10")]),e("br"),e("span",{staticClass:"line-number"},[n._v("11")]),e("br"),e("span",{staticClass:"line-number"},[n._v("12")]),e("br"),e("span",{staticClass:"line-number"},[n._v("13")]),e("br"),e("span",{staticClass:"line-number"},[n._v("14")]),e("br"),e("span",{staticClass:"line-number"},[n._v("15")]),e("br"),e("span",{staticClass:"line-number"},[n._v("16")]),e("br"),e("span",{staticClass:"line-number"},[n._v("17")]),e("br"),e("span",{staticClass:"line-number"},[n._v("18")]),e("br"),e("span",{staticClass:"line-number"},[n._v("19")]),e("br"),e("span",{staticClass:"line-number"},[n._v("20")]),e("br"),e("span",{staticClass:"line-number"},[n._v("21")]),e("br"),e("span",{staticClass:"line-number"},[n._v("22")]),e("br"),e("span",{staticClass:"line-number"},[n._v("23")]),e("br"),e("span",{staticClass:"line-number"},[n._v("24")]),e("br"),e("span",{staticClass:"line-number"},[n._v("25")]),e("br"),e("span",{staticClass:"line-number"},[n._v("26")]),e("br"),e("span",{staticClass:"line-number"},[n._v("27")]),e("br"),e("span",{staticClass:"line-number"},[n._v("28")]),e("br"),e("span",{staticClass:"line-number"},[n._v("29")]),e("br"),e("span",{staticClass:"line-number"},[n._v("30")]),e("br"),e("span",{staticClass:"line-number"},[n._v("31")]),e("br"),e("span",{staticClass:"line-number"},[n._v("32")]),e("br"),e("span",{staticClass:"line-number"},[n._v("33")]),e("br"),e("span",{staticClass:"line-number"},[n._v("34")]),e("br"),e("span",{staticClass:"line-number"},[n._v("35")]),e("br"),e("span",{staticClass:"line-number"},[n._v("36")]),e("br")])])])}),[],!1,null,null,null);s.default=a.exports}}]);